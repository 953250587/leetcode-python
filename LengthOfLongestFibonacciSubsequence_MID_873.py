"""
A sequence X_1, X_2, ..., X_n is fibonacci-like if:

n >= 3
X_i + X_{i+1} = X_{i+2} for all i + 2 <= n
Given a strictly increasing array A of positive integers forming a sequence, find the length of the longest fibonacci-like subsequence of A.  If one does not exist, return 0.

(Recall that a subsequence is derived from another sequence A by deleting any number of elements (including none) from A, without changing the order of the remaining elements.  For example, [3, 5, 8] is a subsequence of [3, 4, 5, 6, 7, 8].)



Example 1:

Input: [1,2,3,4,5,6,7,8]
Output: 5
Explanation:
The longest subsequence that is fibonacci-like: [1,2,3,5,8].
Example 2:

Input: [1,3,7,11,12,14,18]
Output: 3
Explanation:
The longest subsequence that is fibonacci-like:
[1,11,12], [3,11,14] or [7,11,18].


Note:

3 <= A.length <= 1000
1 <= A[0] < A[1] < ... < A[A.length - 1] <= 10^9
(The time limit has been reduced by 50% for submissions in Java, C, and C++.)
"""


class Solution(object):
    def lenLongestFibSubseq(self, A):
        """
        :type A: List[int]
        :rtype: int
        """
        memory = {}
        a = set(A)
        def dfs(i, j):
            if (i, j) in memory:
                return memory[(i, j)]
            ans = 0
            cur_i, cur_j = i, j
            while i + j in a:
                i, j = j, i + j
                ans += 1
            memory[(cur_i, cur_j)] = ans
            return ans

        l = len(A)
        result = 0
        for i in range(l - 2):
            for j in range(i + 1, l - 1):
                # print(A[i], A[j])
                result = max(dfs(A[i], A[j]) + 2, result)
                # print(result)
        return result if result >= 3 else 0

    def lenLongestFibSubseq_1(self, A):
        """
        1688 ms
        :param A:
        :return:
        """
        l = len(A)
        dicts = {val:i for i, val in enumerate(A)}
        mapList =[[1 for _ in range(l)] for _ in range(l)]
        for i in range(1, l):
            mapList[0][i] = 2
            # mapList[i][0] = 2
        ans = 0
        for j in range(1, l):
            for i in range(j):
            # for i in range(1, l):
                t = A[j] - A[i]
                if t in dicts:
                    mapList[i][j] = mapList[dicts[t]][i] + 1
                else:
                    mapList[i][j] = 2
                ans = max(ans, mapList[i][j])
        return ans if ans >= 3 else 0

    def lenLongestFibSubseq_2(self, A):
        """
        836ms
        :param A:
        :return:
        """
        S = set(A)
        ans = 0
        for i in range(len(A)):
            for j in range(i + 1, len(A)):
                """
                With the starting pair (A[i], A[j]),
                y represents the future expected value in
                the fibonacci subsequence, and x represents
                the most current value found.
                """
                x, y = A[j], A[i] + A[j]
                length = 2
                while y in S:
                    x, y = y, x + y
                    length += 1
                ans = max(ans, length)
        return ans if ans >= 3 else 0

    def lenLongestFibSubseq_3(self, A):
        """
        584ms
        :param A:
        :return:
        """
        import collections
        index = {x: i for i, x in enumerate(A)}
        longest = collections.defaultdict(lambda: 2)

        ans = 0
        for k, z in enumerate(A):
            for j in range(k):
                i = index.get(z - A[j], None)
                if i is not None and i < j:
                    cand = longest[j, k] = longest[i, j] + 1
                    ans = max(ans, cand)

        return ans if ans >= 3 else 0
print(Solution().lenLongestFibSubseq_1([1,2,3,4,5,6,7,8]))
print(Solution().lenLongestFibSubseq_1([1,3,7,11,12,14,18]))
print(Solution().lenLongestFibSubseq_1([2,4,7,8,9,10,14,15,18,23,32,50]))
print(Solution().lenLongestFibSubseq_1([1,3,5]))
print(Solution().lenLongestFibSubseq_1([1,4,6,7,18,30,31,41,42,43,47,54,58,59,60,61,62,63,64,68,75,80,85,88,92,98,100,114,116,122,128,135,143,147,153,158,174,182,185,192,209,213,214,218,258,288,307,317,320,330,341,356,361,416,462,492,499,512,544,554,565,579,674,750,799,816,832,874,895,921,940,1090,1212,1291,1315,1344,1418,1449,1486,1519,1764,1962,2090,2131,2176,2292,2344,2407,2459,2854,3174,3381,3446,3520,3710,3793,3893,3978,4618,5136,5471,5577,5696,6002,6300,7472,8310,8852,9023,9216,9712,10193,12090,13446,14600,14912,15714,19562,23623,24128,25426,31652,38223,39040,41140,51214,61846,63168,66566,82866,100069,102208,107706,134080,161915,165376,174272,216946,261984,267584,281978,351026,423899,432960,456250,567972,608815,685883,700544,738228,918998,951222,1109782,1133504,1194478,1486970,1565801,1795665,1932706,2044392,2330726,2405968,2559698,2873539,2905447,3127184,3892938,3911900,4567487,4692269,4701112,5059890,5786985,6298906,6323321,8759759,8859227,9582997,10191844,10759191,14592748,15236859,16490750,17258992,18995173,19917974,21937912,22028824,22631293,22923043,23705543,24370287,25284118,25502746,26591383,29298630,29488945,32915351,33901815,35336875,39966790,40429753,40782949,42034433,45414628,46229706,46601302,47420000,47681571,48712708,51740144,51900133,53357798,53936952,55381585,56679168,62266553,62550854,62963722,63046154,63643386,64022182,64397639,65576008,67384950,67406549,68209572,69134827,69490696,71157266,72933504,75596923,77608371,77731557,78763576,79161223,80046057,80220600,80738987,82950133,83036492,85394039,88295522,89218689,89439267,89703463,89977713,90142175,90310727,91154244,92643371,93022760,94275889,94637396,97590878,99996330,100115610,100947728,100959484,102786600,104307827,104600560,105312439,106184402,107289244,107299554,108121918,110287804,111943912,113020734,118056448,118109383,119656955,120090461,121628682,122285068,122635834,122814565,123820528,123864355,126023762,126657501,127449836,131134530,131732934,132083771,132146384,134937007,137719562,137980864,139086767,139493639,139743363,140618511,144929884,146441214,147480945,149350691,149424399,150585793,153201957,154086384,155007557,156621463,157024816,158364243,158752572,159175767,160549481,162880390,163112842,163606397,163686226,164428095,165950242,166223136,167470626,175100637,175326140,176238899,176770892,178919167,179126815,183318272,185832936,187712314,188178325,190517118,192417487,192737686,192750274,194213407,194323733,194848523,195249823,195602005,197903673,198571498,199793709,201993776,204199503,204786139,206758865,206846463,207262818,207853577,209067379,209079452,210218618,210341610,210634995,212145593,215220793,221171002,223040321,224662345,226506266,226886480,227089027,227967001,228757457,231405324,233311872,233500473,233538345,233768868,234534045,235672067,236123966,236604385,238846967,239494121,240641520,241692088,244191334,244855503,246777577,247940441,248669830,250469424,252723771,257336334,257437596,257865166,258450114,261694092,264323625,264943980,267103545,269763888,276087824,281736924,285745528,289457471,289768179,291431104,291689811,291905540,292332964,294617143,295829713,296799496,297155155,297671323,298088973,298852411,301195238,301873852,304024667,304520205,306147219,308096177,309074472,310005477,310295319,310441944,310856619,310897167,312098435,312128841,312766392,313100498,313685448,314204092,314447483,314453498,314671477,315246242,315422893,317303144,321244268,322346687,323223644,323950588,324876397,325878752,326125455,326895881,328020351,328531454,329857576,330737112,331590865,333622351,335083892,335806729,336261438,336642998,336701051,337174780,337417911,337449646,338715592,340253232,340559627,342741575,342772217,346475829,346592674,347919730,348217854,349033896,350703158,350842206,354602692,355478926,355720401,357319099,360199504,362725981,363861642,364051842,365750311,370527505,371150309,371356058,372304649,373341576,373819346,375951462,376074663,378180772,378181649,378614431,379377936,379385798,380029366,380565157,380919643,382057874,383222938,384089562,385412173,386064477,386371983,386588400,386702072,389162728,392214136,393042420,393561482,394013459,394733911,394913146,395278783,395545688,395842350,396833051,398442339,400239626,400937028,402048456,402735008,403043228,404835807,405864793,406054532,407093935,407435387,408537399,408621130,409689465,411281624,411541697,415007750,415692686,417354306,417569012,417900565,419418119,422219901,424983068,428120248,428510059,429014688,429242011,430521674,431553693,432259552,432784199,433987779,434441606,434665042,438168110,440538005,440623663,441675310,441886584,442927862,443749614,445063353,445068993,445367927,445989512,447202504,447650533,448189428,448240122,448560286,450150898,450855869,451734330,452238303,452708175,457301360,457564185,457716793,458242000,458523624,460524428,460626717,461349063,461531681,462213282,466218273,466644253,468246830,471146391,471809360,472462763,472790410,475226607,478206903,485113287,485832150,486690776,487515878,487613144,489455699,490313840,491002719,493294611,494016999,494880905,494898765,494979442,496573541,497091790,497855998,498483439,499907932,501940773,504966176,505262788,507085586,509106184,509769815,510254298,510716487,511215888,511234123,512867219,513721694,513767261,515110920,515629544,523553836,524044536,525050962,527218245,527369101,531490648,531912573,532219835,532238423,537116627,538484884,538827766,539245623,539267208,540372983,543502364,543785778,545858141,546812350,547100171,549500173,550177879,550337635,552492623,554519985,554784323,554943105,555152962,555287469,556411562,556717273,557836925,558746916,559376676,560813355,564403123,565745755,566555434,569846952,570218443,570765111,571254233,572356498,572727324,575273321,575395656,575862131,577243144,577270022,577721750,578675308,578832888,578904417,579902492,580246607,580381913,580823462,581202886,582608940,584061061,584663610,584874701,585863223,588545345,588775537,589961953,590292200,591176565,594775583,596098659,596205929,599092014,599243756,602473994,603276781,605124512,605326022,606246028,608759145,611130562,613543824,614577537,615449912,618152175,618429694,618601260,618919940,618954544,620904823,621174325,623471819,625190346,633293186,634846888,636568102,636844815,638070955,641252837,642685548,643098638,643529831,643630516,643635847,643792744,646123646,650849524,654534183,655438169,657285820,657390609,657960032,657965408,658570418,660506301,661865025,662450478,662841804,664901314,665880154,666674944,666697361,669366993,671810962,672861141,673381719,675690038,675986521,677425923,679438685,682227855,683300749,683717487,684422711,686072012,687713733,690729989,692161295,692397826,693880795,694152695,694235427,694305351,694992762,695433709,695968145,696326156,699499613,700799128,701566642,702693808,703535129,705298911,705341880,706309436,707501900,708700112,711881158,712025404,712181337,715799261,722252095,723290098,723607258,724956694,725460839,726200491,726603788,727935984,728438382,732488978,734811221,738004943,738785620,739109388,739559306,741843843,742157078,742768480,744121084,745035410,745999810,746754645,748275915,749319556,749341349,750890975,751068699,751737628,756083431,756684036,758360688,758711894,759055214,761260751,761303832,761431738,762694003,763351052,766882412,767196755,767406525,767827233,768809721,769853431,772753589,773382895,775000238,777204586,780345053,781397567,781990612,783280258,784182970,785972843,788735978,790269987,792014351,795087361,796149757,797047644,797553527,799212040,799787135,799893424,801463228,804646894,805407516,808070336,808128397,808323789,808363349,816007600,817704060,817800501,818553198,820097299,822916353,824818875,825098143,826105441,826427887,830276887,832727582,833044814,833133354,833421070,835572624,835696679,837331127,837403782,843590229,845564553,846615956,847096965,847860170,847874577,847894619,849011078,849835558,851346883,851350910,851363102,853194991,853748619,855187650,855473584,858038735,859054746,861310233,862541770,865551076,865652598,868502600,870970427,871892073,873206369,875328249,875406935,875850929,879251320,880210046,880915966,881828402,883067045,885193460,888320136,888776308,891538381,893757584,897796781,898307902,898661075,898944406,899288695,900138799,900970996,901038669,902442566,903359428,903659156,904058344,904218014,905460265,906007740,906241242,907208969,910508296,911603849,913223076,918940356,919434629,919824764,921756193,922958278,927314869,927829476,928218694,928872075,928995432,929550359,929794603,932331841,932905286,933560610,933601819,935865319,937790486,940693724,941838506,941991851,942839746,942975770,944842205,944918283,945314909,950131870,950371145,951509799,951884568,952535165,952667794,952837842,953589741,955490077,958542728,960647991,960829698,961440476,962364964,963953458,965217325,967061999,967091782,969007410,969388412,970975970,971313339,972250875,973660310,976891593,977110621,977291220,977445472,982231656,982397671,984529947,987274863,987744113,988484618,990639973,990664626,991743099,991924222,993351444,994984091,996098037,998299596,999824459]))

print(Solution().lenLongestFibSubseq_1([2,5,6,11,13,14,15,17,18,20,22,27,28,31,32,33,38,41,45,46,50,51,55,56,58,61,68,69,73,77,78,84,96,97,107,114,118,122,128,135,151,154,163,166,182,199,206,219,250,263,270,296,321,334,354,404,429,433,478,520,540,573,692,703,774,841,927,1121,1136,1252,1361,1500,1813,1839,2202,2427,2934,2975,3563,3927,4747,4814,5765,6354,7681,7789,9328,10281,12428,12603,15093,16635,20109,20392,24421,26916,32537,39514,52646,63935]))
print(Solution().lenLongestFibSubseq_1([4,6,8,10,25,32,35,41,48,52,53,60,66,72,80,84,88,91,95,96,97,98,99,102,129,132,138,149,151,152,155,179,200,203,210,216,226,232,235,245,250,270,302,348,354,355,373,384,394,405,449,502,557,558,564,581,608,616,639,655,719,804,906,911,912,936,981,1000,1033,1060,1168,1306,1464,1468,1476,1589,1616,1672,1715,1887,2110,2370,2388,2570,2616,2705,2775,3055,3416,3834,3864,4159,4232,4377,4490,4942,5526,6204,6252,6729,6848,7082,7265,7997,8942,10038,10116,10888,11080,11459,11755,12939,16242,16368,17617,17928,18541,19020,20936,26280,26484,28505,29008,30000,30775,33875,42522,42852,46122,46936,49795,54811,68802,69336,74627,75944,80570,88686,112188,120749,122880,143497,181524,195376,198824,232183,293712,316125,321704,375680,475236,511501,520528,607863,768948,827626,842232,983543,1244184,1339127,1362760,1591406,2013132,2166753,2204992,2574949,3257316,3505880,3567752,4166355,4800404,5270448,5672633,5772744,6741304,7299063,8527764,9100163,9178513,9340496,10907659,11138789,11327609,13477294,13798212,15040181,15149078,15261924,15323833,16867589,17410438,17648963,18385969,19958649,21543311,22887650,23649965,26467867,26543337,27259692,27330750,28530282,29037113,30066010,33798768,34395757,35725831,37504825,41969915,42018564,44391387,44404575,45455592,46654192,50731454,50865572,54395791,54437496,55810259,58302572,59440987,60711487,61072024,65078581,65985311,67370856,67750874,69161512,70911615,72549611,73314198,73787981,75282450,79479140,79918445,81909737,82269553,83729078,83766649,85759160,87258785,87963227,88124553,91717991,96260891,97270103,97480538,97580271,97904042,98742073,98878101,102666974,102741463,103691671,104832402,109169122,110927182,112512866,115080235,116943653,117235239,117760216,118017527,118297384,118714748,118790606,119218785,120806539,121433749,124317236,124771538,128378885,128599251,129105071,129625626,130918156,131212488,133001893,134669557,135124244,136772396,142517347,144859662,146237839,146542001,146926536,150404283,150916806,151862190,153485432,155832601,158417907,159253707,159812008,160268461,160753590,160887305,161450507,162448183,163554024,164028673,165275244,165476351,165622031,169240984,169517421,170199562,170704489,171294766,171551924,172692939,172695420,173416477,173666977,175847138,176078812,177751788,178483707,178491131,180739367,180777827,182454194,182983382,183530436,190411978,191130573,191611328,191884595,196166745,196210035,196564145,200459127,201312573,203779405,205176046,205711341,206685559,206726241,207443248,207697821,209927165,210204714,210320485,210736494,210952949,211573378,212740220,213472195,215254349,216135838,216800397,218197824,218496062,220035577,220790805,224703722,224809215,224896395,225116763,227428599,227758738,228750058,228986293,233195485,233715294,234011673,234406451,235039818,235240014,236184340,237343844,238678977,242207557,243116208,244121334,244529507,245951789,246686880,248110238,248625387,249046530,249736144,250299194,252546104,253692740,254921069,255618001,255946038,258885156,259488813,260052136,262303187,262499188,264469273,267298837,267337671,268140560,268509252,269256744,269294076,272129223,272574277,273192828,275314647,275900227,276377422,278129691,278380897,278779466,279135025,279232518,279526827,280218827,280370720,282000408,285126290,286538157,287483322,288040573,292736236,292823702,296156047,297338228,298074868,303386115,303918991,304735791,305505311,306319462,309470524,309720240,309874897,310432369,310861584,311612236,315320772,317743590,320452467,322188832,322199018,323032337,325586691,326664187,331252731,332248911,334323274,334880541,336222352,337626212,338932326,339476642,341765077,342123517,343431954,344428293,345049707,346028709,348104648,350334156,352872340,352996465,353733278,355628399,356165993,356174582,358544966,361762454,365960807,369049595,370730723,374980120,378563921,382033834,382504514,382622079,383637428,384991564,385093946,386455207,387068389,389212742,390349622,390953824,391153221,391742131,392685885,393165821,393441827,394289999,394295957,394302842,395554769,395935333,396274252,396537087,400723689,401657143,402417525,403199031,404978496,405225432,405782514,408170872,408193404,408525576,410484555,412339114,413804997,414966034,415702044,418427452,422135420,423623842,427957023,427982003,428707804,428719346,428738284,428770355,428801319,428865254,430034100,432477408,437534712,438116952,438823203,441741551,441887377,443562374,443720685,444741343,444882351,445926727,446493142,447507490,448661066,448704720,450001237,458617544,459034493,459970640,461911263,466694778,467146270,467931837,468611695,468932608,470683899,475298539,475305235,477714384,478508293,478509775,480560793,480781663,482550331,483417018,484159983,484736963,485261137,488955991,489378772,490172047,490935183,495537732,497780315,498133769,502095129,502099701,503116131,503764222,504719738,506569321,507041664,508172640,509404505,510676131,511473682,511839543,512597312,513436011,515470276,515774875,516064973,518349323,518833532,519569264,519678426,522507209,523092948,523354913,523802760,524193202,526697728,532819221,533077598,535298084,535878450,537447983,538057235,539314888,541938706,543839995,544644487,546305749,547955583,548498125,551170705,551324502,552134774,552875715,554679725,555353306,557687823,558343471,558986699,559230512,559323301,559938585,560210891,563226027,563507307,563909638,564288467,564452443,566969750,568506211,573273713,573293349,574111283,574582812,576065254,576812058,577354774,581867043,583274433,583585557,586271907,588011379,588399212,588784161,590350897,590781481,592684605,593221065,595823719,597359785,598221415,599041131,602744039,603394282,606285240,606837133,606902132,607750377,609004762,609513414,610997700,611930801,613092486,615763215,616246550,619321332,619366899,619781817,620564307,621018743,621696521,622204999,623017567,624224960,625169364,626017942,627837229,628381488,628801581,629355354,629746210,630010201,630224203,631466298,632174174,635066467,635842540,636241889,636349787,636734664,637158089,638909369,638920881,638978098,639710792,640223363,640597826,641804285,644099534,644246516,644252854,645567301,646767031,647352418,648184791,649141154,652479512,652643571,654202248,656288667,656791472,658844147,659005922,659018171,659328019,659410733,660353767,662846350,663035685,664349572,665243624,665630893,667609141,668075001,669658188,669853082,670926647,671518838,672590057,673448382,675409010,677529647,682000641,682298607,685174459,685211992,687089529,687963712,689606726,689986879,692962235,694932052,694953874,695415821,696066424,696205111,698209660,698578810,698754472,699458209,700053058,701874692,705450532,705678387,707723481,707724103,708979402,709444593,709602353,711746632,711807371,712058280,715338240,715865570,716971916,720465470,724451879,725748858,726019174,726774142,728782969,729145567,729849464,729901137,730364098,730900623,732540837,732680160,734125356,735806843,737894147,738395274,738730395,739960140,740500748,743918447,745789040,747005335,747407724,748440818,749072636,749672950,750294272,756158823,756607891,757160651,757376462,757453926,757623300,758181533,758684378,759811013,762194758,762328733,762371135,762660015,764785932,767688694,768277733,768300140,768738685,769122914,769900343,771122534,773428875,774307060,774656795,774873614,775462463,775500760,775521554,776137808,779041380,781826319,783101346,784031542,785440894,786090074,786810925,788505257,788794038,790209347,790224132,792033511,792912910,793304089,793888566,794508926,796871223,797697652,798010732,798982932,799618476,800503895,800780021,801020721,801184593,802063759,802579700,803731973,804358989,805319102,805419344,806176494,808159462,808835191,809662023,810812299,811042789,812789401,814146275,817042932,817213981,817576495,818032332,818414608,819313435,819431359,820029265,820526089,820883336,821751196,822322258,823163420,824568732,825062717,826001700,826609848,827140635,828721858,828840727,829633482,830324289,830941554,832188890,832624466,833695725,837148579,839608845,839822265,841747069,842086362,844188596,849562324,850094913,850985067,852895013,853110529,855853282,859692693,861345992,861551975,863069758,863303092,864241569,867682266,870833029,871407612,871591557,871799113,873360562,882171498,882272160,883992445,885751157,886569216,887014525,887722138,888124241,889159483,889612903,889625378,891248425,892942463,895181068,898798302,899335843,901424631,906096732,906184588,908123669,908779798,909128669,909455698,910542681,913876383,916211361,917239717,918429007,918443330,919692289,923902859,923954877,924987600,926209334,926212160,927674602,928604677,929149875,929501783,929900504,932798449,933476010,934474781,934963565,935934137,937259497,938552445,939986753,941569521,942276119,943384033,945888523,950410096,954865788,955573763,958118550,959943438,960015269,960772049,961482853,962713789,964842667,965101620,965621934,965824091,966530963,968038239,970133147,970616596,972787629,972878934,973340287,973486974,975990610,976484621,978434291,980535199,980833321,981360850,982686980,984746913,988793122,990828691,992047866,993644699,995973354,997809191,998408230]))